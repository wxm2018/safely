<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>网站后台管理模版</title>
		<link rel="stylesheet" type="text/css" href="../static/admin/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="../static/admin/css/admin.css"/>
		<script src="../static/admin/js/jquery-3.3.1.js" charset="utf-8"></script>
	</head>
	<body>
		<div class="layui-tab page-content-wrap">
		  <ul class="layui-tab-title">
		    <li class="layui-this" lay-id="1">修改资料</li>
		    <li>修改密码</li>
		  </ul>
		  <div class="layui-tab-content">
		    <div class="layui-tab-item layui-show">
		    	<form class="layui-form"  style="width: 90%;padding-top: 20px;">
				  <div class="layui-form-item">
				    <label class="layui-form-label">账号：</label>
				    <div class="layui-input-block">
				      <input type="text" name="tel" id="tel1" disabled autocomplete="off" class="layui-input layui-disabled" >
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">姓名：</label>
				    <div class="layui-input-block">
				      <input type="text" name="name" id="name" required  lay-verify="required" placeholder="请输入姓名" autocomplete="off" class="layui-input" >
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">邮箱：</label>
				    <div class="layui-input-block">
				      <input type="text" name="email" id="email" required  lay-verify="required" placeholder="请输入邮箱地址" autocomplete="off" class="layui-input" >
				    </div>
				  </div>
				  <div class="layui-form-item layui-form-text">
				    <label class="layui-form-label">备注：</label>
				    <div class="layui-input-block">
				      <textarea name="desc" placeholder="请输入内容" class="layui-textarea"></textarea>
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <div class="layui-input-block">
				      <button class="layui-btn layui-btn-normal" lay-submit lay-filter="adminInfo">立即提交</button>
				    </div>
				  </div>
				</form>
		    </div>
		    <div class="layui-tab-item">
		    	<form class="layui-form" v style="width: 90%;padding-top: 20px;">
				  <div class="layui-form-item">
				    <label class="layui-form-label">账号：</label>
				    <div class="layui-input-block">
				      <input type="text" name="tel" id="tel2" disabled autocomplete="off" class="layui-input layui-disabled" >
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">旧密码：</label>
				    <div class="layui-input-block">
				      <input type="password" name="password1" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">新密码：</label>
				    <div class="layui-input-block">
				      <input type="password" name="password2" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">重复密码：</label>
				    <div class="layui-input-block">
				      <input type="password" name="password3" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <div class="layui-input-block">
				      <button class="layui-btn layui-btn-normal" lay-submit lay-filter="adminPassword">立即提交</button>
				    </div>
				  </div>
				</form>
		    </div>
			  <div class="layui-tab-item" id="createPassword">
				  <form class="layui-form" v style="width: 90%;padding-top: 20px;">
					  <div class="layui-form-item">
						  <label class="layui-form-label">手机号码：</label>
						  <div class="layui-input-block">
							  <input type="text" name="tel" disabled autocomplete="off" class="layui-input layui-disabled" ><!--保留数据接口-->
						  </div>
					  </div>
					  <div class="layui-form-item">
						  <label class="layui-form-label">密码：</label>
						  <div class="layui-input-block">
							  <input type="password" name="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
						  </div>
					  </div>
					  <div class="layui-form-item">
						  <label class="layui-form-label">重复密码：</label>
						  <div class="layui-input-block">
							  <input type="password" name="password2" required lay-verify="required" placeholder="确认密码" autocomplete="off" class="layui-input">
						  </div>
					  </div>
					  <div class="layui-form-item">
						  <div class="layui-input-block">
							  <button class="layui-btn layui-btn-normal"  lay-submit lay-filter="createPassword" >立即提交</button>
						  </div>
					  </div>
				  </form>
			  </div>
		  </div>
		</div>
	<script src="../static/admin/layui/layui.js" type="text/javascript" charset="utf-8"></script>
	<script>






		layui.use(['form','element'], function(){
		  var form = layui.form();
		  var element = layui.element();
		  form.render();

		  //表单填写
			$.ajax({
				type: 'POST',
				url: 'http://127.0.0.1:8080/user/getIndexInfo' ,
				xhrFields: {withCredentials: true},
				dataType:'json',
				success: function (response) {
					$("#tel1").val(response.tel);
					$("#name").val(response.name);
					$("#email").val(response.email);
					$("#tel2").val(response.tel);

				}

			});





		//监听信息提交
		  form.on('submit(adminInfo)', function(data){
			  $.ajax({
					type: 'POST',
					url: 'http://127.0.0.1:8080/user/resetuserinfo',
				    xhrFields: {withCredentials: true},
					data: data.field,
					end:
						layer.msg("资料修改成功！"),


					dataType: 'json'
				});
					return true;
		  });
		//监听密码提交
		   form.on('submit(createPassword)', function(data){
			if(data.field.password != data.field.password2){
				layer.msg("两次输入的密码不一致，请检查后重新输入！");
				return false;
			}else{
				$.ajax({
					type: 'POST',
					url: 'http://127.0.0.1:8080/user/createPassword',
					contentType : "application/x-www-form-urlencoded",
					data: data.field

					,
					dataType: 'json'
				});
				$("#createPassword").remove();
				$("#liPassword").remove();
				layer.msg("密码创建完成！");
				element.tabChange('demo', '22'); //切换到：用户管理
				return true;





			}


		  });

		   //监听密码创建
			form.on('submit(adminPassword)', function(data){
				if(data.field.password2 != data.field.password3){
					layer.msg("两次输入的密码不一致，请检查后重新输入！");
					layer.msg(JSON.stringify(data.field));
					return false;
				}else{
					$.ajax({
						type: 'POST',
						url: 'http://127.0.0.1:8080/user/resetpassword',
						contentType : "application/x-www-form-urlencoded",
						data: data.field,
						success: function (response) {
							if(response.status=="200"){
								layer.msg("密码修改成功！");


							}else{
								layer.msg("密码输入错误！");
							}
						}
						,
						dataType: 'json'
					});
					return false;


				}


			});

		});
	</script>

	</body>
</html>